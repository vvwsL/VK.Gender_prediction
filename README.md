# Предсказание пола пользователей соцсетей
Пет-проект по обработке событий пользователей и предсказанию пола на основе веб-активности.

Модель машинного обучения предсказывает пол пользователей по данным их веб-логов: браузер, ОС, геолокация, referer, временные параметры и агрегированная активность.

---

## Описание проекта

Проект реализует полный ML-pipeline для анализа пользовательской активности и предсказания пола.  
Используется модель LightGBM и набор сгенерированных признаков, полученных из сырых данных.

Ключевые этапы:
- загрузка данных  
- предобработка (user_agent, referer, геоданные)  
- генерация временных и агрегированных признаков  
- обучение модели  
- оценка качества  
- предсказание на тестовых данных  

---

## Основные возможности

- Предобработка сырых веб-логов  
- Парсинг user_agent и referer  
- Создание агрегированных признаков на уровне пользователя  
- Временные признаки (час, день недели)  
- Обучение модели LightGBM  
- Ранняя остановка и оптимизация  
- Предсказание пола для новых пользователей  
- Экспорт признаков, модели и результатов  

---

## Структура данных

### Входные файлы:
- `train.csv` — данные событий  
- `train_labels.csv` — метки пользователей  
- `test.csv` — тестовые данные  
- `geo_info.csv` — геолокация  
- `referer_vectors.csv` — векторные признаки referer

### Выходные файлы:
- `model_gender.pkl` — обученная модель  
- `train_features.csv` — признаки обучения  
- `gender_predictions.csv` — финальные предсказания  

---

## Этапы обработки

### 1. Загрузка данных
```python
train_df = pd.read_csv(train_csv_path, sep=';', encoding='utf-8')
train_labels_df = pd.read_csv(train_labels_path, sep=';', encoding='utf-8')
geo_info_df = pd.read_csv(geo_info_path, sep=';', encoding='utf-8')
referer_vectors_df = pd.read_csv(referer_vectors_path, sep=';', encoding='utf-8')
```

### 2. Предобработка данных
- объединение train и train_labels  
- парсинг user_agent -> браузер, устройство, ОС  
- извлечение домена и пути из referer  
- объединение с геоданными и векторными признаками  

### 3. Генерация признаков
- ограничение категорий (браузеры, ОС, домены)  
- временные признаки (час, день недели)  
- агрегированные статистики по пользователям:
  - количество событий  
  - распределение браузеров и ОС  
  - статистики векторных признаков (mean, max, std)  
  - временные распределения  

### 4. Обучение модели

Параметры LightGBM:
```python
params = {
    'objective': 'binary',
    'metric': ['binary_logloss','auc'],
    'learning_rate': 0.05,
    'num_leaves': 31,
    'feature_fraction': 0.8,
    'bagging_fraction': 0.8
}
```

- разделение данных: 80% train / 20% validation  
- ранняя остановка  
- метрики: Accuracy и ROC AUC  

### 5. Сохранение модели
- `model_gender.pkl`  
- сохранение обучающих признаков  

### 6. Предсказание
- загрузка тестового набора  
- та же предобработка  
- генерация признаков  
- согласование признаков с обучением  
- сохранение результата в `gender_predictions.csv`  

---

## Установка и запуск

### 1. Клонирование репозитория:
```bash
git clone https://github.com/vvwsL/VK.Gender_prediction.git
cd VK.Gender_prediction
```

### 2. Установка зависимостей:
```bash
pip install -r requirements.txt
```

### 3. Запуск обучения и предсказания:
```bash
python practice.py
```

---

## Результаты

Модель выводит:
- Accuracy
- ROC AUC

Финальный файл предсказаний (`gender_predictions.csv`) имеет формат:

```csv
user_id;target
12345;1
67890;0
```

---

## Особенности реализации

- Полный пайплайн обработки данных  
- Агрегация признаков по user_id  
- Использование LightGBM как основной модели  
- Работа с разнородными источниками данных (логи, рефереры, гео, вектора)  
- Гибкая система генерации признаков  
